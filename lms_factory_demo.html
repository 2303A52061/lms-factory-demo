<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;LMS Factory Method Demo&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#0b1220;color:#e6eef6}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.wrap{max-width:1000px;margin:28px auto;padding:18px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>header{display:flex;align-items:center;gap:12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>h1{margin:0;font-size:20px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.grid{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:16px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{background:#071024;padding:14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.6)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>input,select,button,textarea{font:inherit}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn{background:#06b6d4;border:none;color:#022;padding:8px 10px;border-radius:8px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#94a3b8;padding:6px 8px;border-radius:8px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.list{display:flex;flex-direction:column;gap:8px;margin-top:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.book{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.meta{display:flex;flex-direction:column}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.muted{color:#94a3b8;font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.small{font-size:13px;color:#94a3b8}</p>
<p class="p1"><span class="Apple-converted-space">    </span>footer{margin-top:14px;color:#94a3b8}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media(max-width:880px){.grid{grid-template-columns:1fr}}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#06b6d4,#7dd3fc);display:flex;align-items:center;justify-content:center;color:#022;font-weight:700"&gt;L&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1&gt;Library Management System — Factory Method Demo&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="muted"&gt;Factory creates Student / Librarian objects. Demo app (local only).&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;!-- LEFT PANEL --&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;aside class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="display:flex;gap:8px;align-items:center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;select id="roleSelect"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="student"&gt;Student&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="librarian"&gt;Librarian&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input id="userName" placeholder="Enter name (e.g., Alice)" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="loginBtn" class="btn"&gt;Login&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="small"&gt;Search&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="display:flex;gap:8px;margin-top:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input id="searchInput" placeholder="title / author / isbn" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="searchBtn" class="btn"&gt;Search&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="small"&gt;Notifications&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="notifications" class="muted" style="margin-top:6px"&gt;(login to see your reminders)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="small"&gt;Librarian: Add Book&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="addBookPanel" style="display:none;margin-top:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="bkTitle" placeholder="Title" style="width:100%;padding:8px;border-radius:6px;margin-bottom:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="bkAuthor" placeholder="Author" style="width:100%;padding:8px;border-radius:6px;margin-bottom:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="bkIsbn" placeholder="ISBN" style="width:100%;padding:8px;border-radius:6px;margin-bottom:6px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="bkCopies" type="number" min="1" value="1" style="width:100%;padding:8px;border-radius:6px;margin-bottom:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div style="display:flex;gap:8px"&gt;&lt;button id="addBookBtn" class="btn"&gt;Add&lt;/button&gt;&lt;button id="clearBtn" class="secondary"&gt;Clear&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="resetBtn" class="secondary"&gt;Reset Sample Data&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/aside&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;!-- RIGHT PANEL --&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="display:flex;justify-content:space-between;align-items:center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div class="small" style="font-weight:700"&gt;Catalog&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div class="muted"&gt;search, borrow and return books&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div style="text-align:right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div class="small muted"&gt;User: &lt;span id="curUser"&gt;(not logged in)&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div class="small muted"&gt;Role: &lt;span id="curRole"&gt;-&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div id="bookList" class="list" style="margin-top:12px"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="small" style="font-weight:700"&gt;My Borrow Records&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div id="borrowRecords" class="muted" style="margin-top:8px"&gt;(login as student to see borrows)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="card" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="small" style="font-weight:700"&gt;Admin View (Librarian)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div id="adminView" class="muted" style="margin-top:8px"&gt;(login as librarian to see reports)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;footer class="muted"&gt;Demo: local-only. Due date default 14 days. Fine ₹5/day.&lt;/footer&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/main&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>/***********************</p>
<p class="p1"><span class="Apple-converted-space">   </span>* Factory Method Pattern: JS implementation</p>
<p class="p1"><span class="Apple-converted-space">   </span>***********************/</p>
<p class="p1"><span class="Apple-converted-space">  </span>class User {</p>
<p class="p1"><span class="Apple-converted-space">    </span>constructor(id, name){ this.id=id; this.name=name; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>getRole(){ throw new Error('Abstract method'); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>class Student extends User {</p>
<p class="p1"><span class="Apple-converted-space">    </span>getRole(){ return 'Student'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>// student actions could be added here</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>class Librarian extends User {</p>
<p class="p1"><span class="Apple-converted-space">    </span>getRole(){ return 'Librarian'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>// librarian actions...</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>class UserFactory {</p>
<p class="p1"><span class="Apple-converted-space">    </span>static create(type, id, name){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(!type) throw new Error('type required');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const t = type.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(t === 'student') return new Student(id, name);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(t === 'librarian') return new Librarian(id, name);</p>
<p class="p1"><span class="Apple-converted-space">      </span>throw new Error('Unknown user type');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>/***********************</p>
<p class="p1"><span class="Apple-converted-space">   </span>* Simple LMS data + helpers (localStorage)</p>
<p class="p1"><span class="Apple-converted-space">   </span>***********************/</p>
<p class="p1"><span class="Apple-converted-space">  </span>const STORAGE_KEY = 'lms_factory_demo_v1';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const FINE_PER_DAY = 5;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const DUE_DAYS = 14;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const SAMPLE = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>users:[</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:1,name:'Alice',isLibrarian:false},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:2,name:'Bob',isLibrarian:false},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:3,name:'Librarian',isLibrarian:true}</p>
<p class="p1"><span class="Apple-converted-space">    </span>],</p>
<p class="p1"><span class="Apple-converted-space">    </span>books:[</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:1,title:'The Hobbit',author:'J.R.R. Tolkien',isbn:'978-0618968633',copies:3,total:3},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:2,title:'1984',author:'George Orwell',isbn:'978-0451524935',copies:2,total:2},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{id:3,title:'Clean Code',author:'Robert C. Martin',isbn:'978-0132350884',copies:1,total:1},</p>
<p class="p1"><span class="Apple-converted-space">    </span>],</p>
<p class="p1"><span class="Apple-converted-space">    </span>borrows:[] // {id,userId,bookId,issueIso,dueIso,returnIso|null,finePaid:false,fineAmount:0}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function loadState(){ try{ const raw=localStorage.getItem(STORAGE_KEY); if(!raw){ localStorage.setItem(STORAGE_KEY, JSON.stringify(SAMPLE)); return JSON.parse(JSON.stringify(SAMPLE)); } return JSON.parse(raw);}catch(e){localStorage.setItem(STORAGE_KEY, JSON.stringify(SAMPLE)); return JSON.parse(JSON.stringify(SAMPLE)); } }</p>
<p class="p1"><span class="Apple-converted-space">  </span>function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let state = loadState();</p>
<p class="p1"><span class="Apple-converted-space">  </span>let currentUserObj = null; // JS object created by factory</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// DOM refs</p>
<p class="p1"><span class="Apple-converted-space">  </span>const bookListEl = document.getElementById('bookList');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const borrowRecordsEl = document.getElementById('borrowRecords');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const adminViewEl = document.getElementById('adminView');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const notificationsEl = document.getElementById('notifications');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const curUserEl = document.getElementById('curUser');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const curRoleEl = document.getElementById('curRole');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const addBookPanel = document.getElementById('addBookPanel');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Utils</p>
<p class="p1"><span class="Apple-converted-space">  </span>const uid = ()=&gt; Math.floor(Math.random()*1e9);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const nowIso = ()=&gt; new Date().toISOString();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const dateOnly = iso =&gt; new Date(iso).toLocaleDateString();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Render functions</p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderBooks(filter=''){</p>
<p class="p1"><span class="Apple-converted-space">    </span>bookListEl.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const q = String(filter || '').trim().toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const books = state.books.filter(b=&gt;!q || b.title.toLowerCase().includes(q) || (b.author||'').toLowerCase().includes(q) || (b.isbn||'').toLowerCase().includes(q));</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(books.length===0){ bookListEl.innerHTML = '&lt;div class="muted"&gt;No books found.&lt;/div&gt;'; return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>books.forEach(b=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const bookDiv = document.createElement('div'); bookDiv.className='book';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const left = document.createElement('div'); left.className='meta';</p>
<p class="p1"><span class="Apple-converted-space">      </span>left.innerHTML = `&lt;div&gt;&lt;strong&gt;${escapeHtml(b.title)}&lt;/strong&gt;&lt;/div&gt;&lt;div class="small muted"&gt;${escapeHtml(b.author)} • ISBN: ${escapeHtml(b.isbn)}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const avail = document.createElement('div'); avail.className='small'; avail.textContent = `${b.copies} / ${b.total} available`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>right.appendChild(avail);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const borrowBtn = document.createElement('button'); borrowBtn.className='btn'; borrowBtn.textContent='Borrow';</p>
<p class="p1"><span class="Apple-converted-space">      </span>borrowBtn.onclick = ()=&gt; handleBorrow(b.id);</p>
<p class="p1"><span class="Apple-converted-space">      </span>borrowBtn.disabled = b.copies&lt;=0 || !currentUserObj || currentUserObj.getRole()!=='Student';</p>
<p class="p1"><span class="Apple-converted-space">      </span>right.appendChild(borrowBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const detailsBtn = document.createElement('button'); detailsBtn.className='secondary'; detailsBtn.textContent='Details';</p>
<p class="p1"><span class="Apple-converted-space">      </span>detailsBtn.onclick = ()=&gt; alert(`${b.title}\nAuthor: ${b.author}\nISBN: ${b.isbn}\nCopies: ${b.copies}/${b.total}`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>right.appendChild(detailsBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>bookDiv.appendChild(left); bookDiv.appendChild(right);</p>
<p class="p1"><span class="Apple-converted-space">      </span>bookListEl.appendChild(bookDiv);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderBorrowRecords(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!currentUserObj || currentUserObj.getRole()!=='Student'){ borrowRecordsEl.innerHTML='(login as a Student to view borrows)'; return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>const recs = state.borrows.filter(b=&gt;b.userId===currentUserObj.id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(recs.length===0){ borrowRecordsEl.innerHTML='No borrow records.'; return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>borrowRecordsEl.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>recs.forEach(r=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const bk = state.books.find(x=&gt;x.id===r.bookId);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const div = document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.padding='8px 0';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const left = document.createElement('div'); left.innerHTML = `&lt;strong&gt;${escapeHtml(bk.title)}&lt;/strong&gt;&lt;div class="small muted"&gt;Issued: ${dateOnly(r.issueIso)} • Due: ${dateOnly(r.dueIso)} • Returned: ${r.returnIso?dateOnly(r.returnIso):'---'}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const right = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(!r.returnIso){</p>
<p class="p1"><span class="Apple-converted-space">        </span>const retBtn = document.createElement('button'); retBtn.className='btn'; retBtn.textContent='Return';</p>
<p class="p1"><span class="Apple-converted-space">        </span>retBtn.onclick = ()=&gt; handleReturn(r.id);</p>
<p class="p1"><span class="Apple-converted-space">        </span>right.appendChild(retBtn);</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>right.innerHTML = `&lt;div class="small"&gt;Fine: ${r.fineAmount} • Paid: ${r.finePaid? 'Yes':'No'}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if(r.fineAmount&gt;0 &amp;&amp; !r.finePaid){</p>
<p class="p1"><span class="Apple-converted-space">          </span>const pay = document.createElement('button'); pay.className='btn'; pay.textContent='Pay Fine';</p>
<p class="p1"><span class="Apple-converted-space">          </span>pay.onclick = ()=&gt; { r.finePaid=true; saveState(state); renderAll(); alert('Fine marked as paid'); }</p>
<p class="p1"><span class="Apple-converted-space">          </span>right.appendChild(pay);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>div.appendChild(left); div.appendChild(right);</p>
<p class="p1"><span class="Apple-converted-space">      </span>borrowRecordsEl.appendChild(div);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderAdmin(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!currentUserObj || currentUserObj.getRole()!=='Librarian'){ adminViewEl.innerHTML='(login as Librarian to view reports)'; return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>let html = '&lt;div style="font-weight:700;margin-bottom:8px"&gt;All Borrow Records&lt;/div&gt;';</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(state.borrows.length===0) html += '&lt;div class="muted"&gt;No records&lt;/div&gt;';</p>
<p class="p1"><span class="Apple-converted-space">    </span>else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>html += '&lt;table style="width:100%"&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;BorrowID&lt;/th&gt;&lt;th&gt;User&lt;/th&gt;&lt;th&gt;Book&lt;/th&gt;&lt;th&gt;Issued&lt;/th&gt;&lt;th&gt;Due&lt;/th&gt;&lt;th&gt;Returned&lt;/th&gt;&lt;th&gt;Fine&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;';</p>
<p class="p1"><span class="Apple-converted-space">      </span>state.borrows.forEach(r=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">        </span>const user = state.users.find(u=&gt;u.id===r.userId);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const bk = state.books.find(b=&gt;b.id===r.bookId);</p>
<p class="p1"><span class="Apple-converted-space">        </span>html += `&lt;tr&gt;&lt;td&gt;${r.id}&lt;/td&gt;&lt;td&gt;${escapeHtml(user.name)}&lt;/td&gt;&lt;td&gt;${escapeHtml(bk.title)}&lt;/td&gt;&lt;td&gt;${dateOnly(r.issueIso)}&lt;/td&gt;&lt;td&gt;${dateOnly(r.dueIso)}&lt;/td&gt;&lt;td&gt;${r.returnIso?dateOnly(r.returnIso):'---'}&lt;/td&gt;&lt;td&gt;${r.fineAmount} ${r.finePaid? '(paid)':''}&lt;/td&gt;&lt;/tr&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>html += '&lt;/tbody&gt;&lt;/table&gt;';</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>adminViewEl.innerHTML = html;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderNotifications(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!currentUserObj){ notificationsEl.textContent = '(login to see reminders)'; return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>const now = new Date();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const msgs = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.borrows.filter(b=&gt;!b.returnIso &amp;&amp; b.userId===currentUserObj.id).forEach(b=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const due = new Date(b.dueIso);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const diffDays = Math.ceil((due - now)/(1000*60*60*24));</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(diffDays &lt; 0) msgs.push(`Overdue: "${getBookTitle(b.bookId)}" was due on ${dateOnly(b.dueIso)}`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>else if(diffDays &lt;=2) msgs.push(`Reminder: "${getBookTitle(b.bookId)}" is due on ${dateOnly(b.dueIso)}`);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>notificationsEl.textContent = msgs.length? msgs.join(' • ') : 'No notifications';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderAll(filter=''){</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderBooks(filter);</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderBorrowRecords();</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderAdmin();</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderNotifications();</p>
<p class="p1"><span class="Apple-converted-space">    </span>curUserEl.textContent = currentUserObj? currentUserObj.name : '(not logged in)';</p>
<p class="p1"><span class="Apple-converted-space">    </span>curRoleEl.textContent = currentUserObj? currentUserObj.getRole() : '-';</p>
<p class="p1"><span class="Apple-converted-space">    </span>addBookPanel.style.display = (currentUserObj &amp;&amp; currentUserObj.getRole()==='Librarian')? 'block':'none';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Helpers</p>
<p class="p1"><span class="Apple-converted-space">  </span>function escapeHtml(s){ return String(s).replace(/&amp;/g,'&amp;amp;').replace(/&lt;/g,'&amp;lt;').replace(/&gt;/g,'&amp;gt;'); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>function getBookTitle(bookId){ const b=state.books.find(x=&gt;x.id===bookId); return b?b.title:'unknown'; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Actions: Borrow / Return / Add book / Login / Reset</p>
<p class="p1"><span class="Apple-converted-space">  </span>function handleBorrow(bookId){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!currentUserObj || currentUserObj.getRole()!=='Student'){ alert('Login as Student to borrow'); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>const book = state.books.find(b=&gt;b.id===bookId);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!book) return alert('Book not found');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(book.copies&lt;=0) return alert('No copies available');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const issueIso = nowIso();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dueDate = new Date(); dueDate.setDate(dueDate.getDate()+DUE_DAYS);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dueIso = dueDate.toISOString();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const borrowRecord = { id: uid(), userId: currentUserObj.id, bookId: book.id, issueIso, dueIso, returnIso: null, finePaid: false, fineAmount: 0 };</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.borrows.push(borrowRecord);</p>
<p class="p1"><span class="Apple-converted-space">    </span>book.copies -= 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>saveState(state);</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderAll(document.getElementById('searchInput').value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert(`Borrowed "${book.title}". Due on ${dateOnly(dueIso)}`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function handleReturn(borrowId){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rec = state.borrows.find(r=&gt;r.id===borrowId);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!rec) return alert('Borrow record not found');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(rec.returnIso) return alert('Already returned');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const returnIso = nowIso();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const due = new Date(rec.dueIso);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ret = new Date(returnIso);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const overdueDays = Math.max(0, Math.ceil((ret - due)/(1000*60*60*24)));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const fine = overdueDays * FINE_PER_DAY;</p>
<p class="p1"><span class="Apple-converted-space">    </span>rec.returnIso = returnIso;</p>
<p class="p1"><span class="Apple-converted-space">    </span>rec.fineAmount = fine;</p>
<p class="p1"><span class="Apple-converted-space">    </span>rec.finePaid = (fine===0);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const book = state.books.find(b=&gt;b.id===rec.bookId);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(book) book.copies += 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>saveState(state);</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderAll(document.getElementById('searchInput').value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(fine&gt;0) alert(`Returned with fine ₹${fine} (${overdueDays} days overdue). Pay via "Pay Fine" in records.`); else alert('Returned on time. No fine.');</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// UI wiring</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('loginBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const name = (document.getElementById('userName').value || '').trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const role = document.getElementById('roleSelect').value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!name) return alert('Enter a name');</p>
<p class="p1"><span class="Apple-converted-space">    </span>// find existing user by name (case-insensitive), else create new</p>
<p class="p1"><span class="Apple-converted-space">    </span>const existing = state.users.find(u=&gt;u.name.toLowerCase()===name.toLowerCase());</p>
<p class="p1"><span class="Apple-converted-space">    </span>let user;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(existing){</p>
<p class="p1"><span class="Apple-converted-space">      </span>user = existing;</p>
<p class="p1"><span class="Apple-converted-space">      </span>// if role mismatch, update isLibrarian flag only if it makes sense</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(role==='librarian') user.isLibrarian = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const newId = state.users.length? Math.max(...state.users.map(u=&gt;u.id))+1 : 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>user = {id:newId, name, isLibrarian: role==='librarian'};</p>
<p class="p1"><span class="Apple-converted-space">      </span>state.users.push(user); saveState(state);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>currentUserObj = UserFactory.create(role, user.id, user.name);</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderAll(document.getElementById('searchInput').value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert(`Logged in as ${user.name} (${currentUserObj.getRole()})`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('searchBtn').addEventListener('click', ()=&gt; renderAll(document.getElementById('searchInput').value));</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('searchInput').addEventListener('keyup', (e)=&gt; { if(e.key==='Enter') renderAll(document.getElementById('searchInput').value); });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('addBookBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!currentUserObj || currentUserObj.getRole()!=='Librarian') return alert('Login as Librarian to add books');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const title = document.getElementById('bkTitle').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const author = document.getElementById('bkAuthor').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isbn = document.getElementById('bkIsbn').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>let copies = parseInt(document.getElementById('bkCopies').value,10);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!copies || copies&lt;1) copies=1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!title) return alert('Title required');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newId = state.books.length? Math.max(...state.books.map(b=&gt;b.id))+1 : 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>state.books.push({id:newId,title,author,isbn,copies,total:copies});</p>
<p class="p1"><span class="Apple-converted-space">    </span>saveState(state); renderAll();</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert('Book added');</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('clearBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('bkTitle').value=''; document.getElementById('bkAuthor').value=''; document.getElementById('bkIsbn').value=''; document.getElementById('bkCopies').value='1';</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById('resetBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!confirm('Reset app sample data?')) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>localStorage.removeItem(STORAGE_KEY);</p>
<p class="p1"><span class="Apple-converted-space">    </span>state = loadState();</p>
<p class="p1"><span class="Apple-converted-space">    </span>currentUserObj = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('userName').value='';</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// make borrow buttons dynamic with event delegation (re-render will recreate)</p>
<p class="p1"><span class="Apple-converted-space">  </span>// initial render</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderAll();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Periodic notification update</p>
<p class="p1"><span class="Apple-converted-space">  </span>setInterval(()=&gt; renderNotifications(), 10_000);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
